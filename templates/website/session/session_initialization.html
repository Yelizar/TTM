{% extends "website/base.html" %}
{% block titel %} Session initialization {% endblock %}
{% block content %}
    {#  logic of the process will be rebuild after a discussion #}
    <h5>Session Initialization</h5>
    <label id="id_student">Student: </label>

    <table id="tutor_list">
    </table>
    <input type="button" value="REDIRECT" id="confirm_student">
    <script>
        var sessionName = {{ session_name_json }};
        var wsProtocol = 'ws://';
        if (window.location.protocol === 'https:'){
            wsProtocol = 'wss://'
        }
        var sessionSocket = new WebSocket(
            wsProtocol + window.location.host +
            '/ws/session-initialization/' + sessionName + '/');

        sessionSocket.onopen = function(e){
            console.log(e)
        };

        sessionSocket.onmessage = function (e) {
            console.log(sessionSocket);
            var data = JSON.parse(e.data);
            if (data['student']) {
                var student = data['student'];
                    document.querySelector('#id_student').innerHTML += " " + student.first_name + ' ' + student.last_name;

            }
            if (data['tutor']) {
                var user = data['tutor'];
                var td = document.createElement('td');
                var tr = document.createElement('tr');
                var lable = document.createElement('label');
                td.setAttribute('id', 'id_tutor_' + user.id);
                lable.innerHTML = "Tutor: " + user.first_name + ' ' + user.last_name;
                td.appendChild(lable);
                tr.appendChild(td);
                document.querySelector('#tutor_list').appendChild(tr);



            }
        };

        sessionSocket.onerror = function(e){
            console.log(e)
        };

        sessionSocket.onclose = function (e) {
            console.error('Chat socket closed unexpectedly');
        };


        {#$('#confirm_student').click(function () {#}
        {#    window.location.href = 'http://127.0.0.1:8000/profile/3'#}

        {#\});#}

    </script>


{% endblock %}